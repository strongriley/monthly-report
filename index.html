Drag this link: <a href='javascript:(function(){var e="0.3";window.calculateMonthly=function(){$.getScript("https://rawgit.com/moment/moment/develop/moment.js").done(function(){var t=document.URL.match(/iapi\/usages\/(\d+)/)[1];var n=$("a").map(function(e,t){return $(t).attr("href")});var r=[];n.each(function(e,t){d=$.getJSON(t);r.push(d)});var i={};var s={};return $.when.apply(this,r).done(function(){$.each(arguments,function(e,n){var r=n[0];var o=r.account_detail[t];var u=moment.utc(r.start);var a=moment.utc(r.account_usage_progress_time);Object.keys(o).forEach(function(e){if(e=="total"){return}var t=moment.utc(e,"YYYY-MM-DD");var n=moment(t).add(24,"hours");var r={val:o[e],startReport:u,endReport:a};if(i[t]===undefined){i[t]=r}else{existing=i[t];if(t<existing.startReport){if(u<t&&a<=existing.endReport){existing.val+=r.val;existing.startReport=u;console.log("overlap on "+t.format("YYYY-MM-DD"))}else{console.error("report not overlapping correctly")}}else if(existing.endReport<n){if(u>=existing.endReport&&a>n){existing.val+=r.val;existing.endReport=a;console.log("overlap on "+t.format("YYYY-MM-DD"))}else{console.error("report not overlapping correctly")}}else{s[t.format("YYYY-MM")]=true;console.log("full repeat of date in report: "+t.format("YYYY-MM-DD"))}}})});var n={};Object.keys(i).forEach(function(e){monthString=moment.utc(e).format("YYYY-MM");if(n[monthString]===undefined){n[monthString]=0}n[monthString]+=i[e].val});sortedMonths=Object.keys(n).sort(function(e,t){var n=e.split("-");var r=t.split("-");var i=parseInt(n[0],10);var s=parseInt(r[0],10);var o=parseInt(n[1],10);var u=parseInt(r[1],10);if(i==s){return u-o}else{return s-i}});$table=$("<table>");$header=$("<tr>");$header.append($("<td>").html("Month"));$header.append($("<td>").html("Usage"));$header.append($("<td>"));$table.append($header);sortedMonths.forEach(function(e){$row=$("<tr>");$row.append($("<td>").html(e));$row.append($("<td>").html(n[e]));if(s[e]===true){$row.append($("<td>").html("*"))}$table.append($row)});$(document.body).append($table);var r="* duplicate data detected in this months report. Best guess attempted, but double-check numbers.";$(document.body).append($("<p>").html(r));$(document.body).append($("<p>").html("Version "+e))})})};var t=document.createElement("script");t.type="text/javascript";t.async=true;t.onload=window.calculateMonthly;var n=document.getElementsByTagName("body")[0];n.insertBefore(t,n.childNodes[0]);t.src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"})()'>Monthly Report</a>
